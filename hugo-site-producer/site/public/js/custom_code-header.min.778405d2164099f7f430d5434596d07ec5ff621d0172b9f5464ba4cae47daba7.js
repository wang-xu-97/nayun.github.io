document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".copy-button").forEach(e=>{if(!e.querySelector(".copy-tooltip")){const t=document.createElement("span");t.className="copy-tooltip",t.textContent="✓ 已复制",e.appendChild(t)}e.addEventListener("click",()=>{const o=e.closest(".code-block-wrapper"),n=o.querySelector("pre code"),i=Array.from(n.querySelectorAll("span:not(.ln)")),c=i.map(e=>e.innerText).join(`
`),l=n.innerText,a=n.querySelectorAll("span.cl"),r=Array.from(a).map(e=>{const t=e.cloneNode(!0),n=t.querySelector("span.ln");return n&&n.remove(),t.textContent.replace(/\n+$/g,"")}).join(`
`),s=e.querySelector(".copy-tooltip"),d=e.innerHTML,t=document.createElement("textarea");t.value=r,document.body.appendChild(t),t.select(),e.classList.add("hide-original"),navigator.clipboard.writeText(t.value).then(()=>{s.style.opacity="1",setTimeout(()=>{s.style.opacity="0",e.classList.remove("hide-original")},2e3)}),document.body.removeChild(t)})}),document.querySelectorAll(".language-label").forEach(e=>{e.addEventListener("click",()=>{const n=e.closest(".code-block-wrapper"),t=n?.querySelector("pre.chroma");t?t.classList.toggle("collapsed"):console.error("折叠失败")})})})